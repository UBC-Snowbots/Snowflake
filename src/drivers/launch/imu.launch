<!-- Phidgets IMU launch file -->

<launch>

  #### Nodelet manager ######################################################

  <node pkg="nodelet" type="nodelet" name="imu_manager" 
    args="manager" output="screen" />

  #### IMU Driver ###########################################################

  <node pkg="nodelet" type="nodelet" name="PhidgetsImuNodelet" 
    args="load phidgets_imu/PhidgetsImuNodelet imu_manager" 
    output="screen">

    # supported data rates: 4 8 16 24 32 40 ... 1000 (in ms)
    <param name="period" value="4"/>

    # compass correction params (see http://www.phidgets.com/docs/1044_User_Guide)
         <param name="cc_mag_field" value="0.56069"/>
         <param name="cc_offset0" value="-0.10514"/>
         <param name="cc_offset1" value="0.02084"/>
         <param name="cc_offset2" value="0.29189"/>
         <param name="cc_gain0" value="1.69568"/>
         <param name="cc_gain1" value="1.74009"/>
         <param name="cc_gain2" value="1.91476"/>
         <param name="cc_t0" value="-0.01658"/>
         <param name="cc_t1" value="-0.02035"/>
         <param name="cc_t2" value="-0.01678"/>
         <param name="cc_t3" value="-0.00163"/>
         <param name="cc_t4" value="-0.02275"/>
         <param name="cc_t5" value="0.00190"/>
  </node>

  #### IMU Orientation Filter ###############################################

  <node pkg="nodelet" type="nodelet" name="ImuFilterNodelet" 
    args="load imu_filter_madgwick/ImuFilterNodelet imu_manager" 
    output="screen">
    
    <!-- Use the raw magnometer reading from the IMU -->
    <param name="use_mag" value="true"/>

    <!-- Setup the estimate of the transform from the IMU to the world -->
    <!-- Don't publish a TF because we publish a static one -->
    <param name="publish_tf" value="false" />
    <param name="world_frame" value="nwu" />
    <param name="fixed_frame" value="base_link" />

  </node>

  <!-- Define a transform from the IMU to the base of the robot -->
  <node pkg="tf" type="static_transform_publisher" name="imu_static_transform" args="0.25 0 0.25 0 0 0 1 base_link imu 100" />

</launch>
